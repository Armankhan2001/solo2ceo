<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>B2B Invoice Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Arial', sans-serif; background: #f1f5f9; }
    .invoice-box { background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 900px; margin: auto; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #d1d5db; padding: 10px; text-align: left; }
    th { background: #f3f4f6; }
    .btn { padding: 10px 15px; border-radius: 8px; margin: 5px; font-weight: bold; cursor: pointer; }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-secondary { background: #16a34a; color: #fff; }
    .btn-warning { background: #eab308; color: #fff; }
    .btn-share { background: #f97316; color: #fff; }
    .status-paid { color: green; font-weight: bold; }
    .status-partial { color: orange; font-weight: bold; }
    .status-none { color: red; font-weight: bold; }
  </style>
</head>
<body class="p-6">

  <h2 class="text-center text-3xl font-bold mb-6 text-blue-700">B2B Invoice Generator</h2>

  <!-- Invoice Form -->
  <div class="invoice-box mb-6">
    <h3 class="font-bold text-lg mb-4 border-b pb-2">Fill Invoice Details</h3>
    <form id="invoiceForm" class="grid grid-cols-2 gap-4">

      <!-- Company Info -->
      <input class="border p-2 col-span-2" type="text" id="companyName" placeholder="Your Company Name" required>
      <label class="col-span-2 text-sm text-gray-600">Upload Company Logo OR Provide Logo URL</label>
      <input class="border p-2" type="file" id="companyLogoFile" accept="image/*">
      <input class="border p-2" type="text" id="companyLogoURL" placeholder="Or paste Logo Image URL">

      <!-- Invoice Details -->
      <input class="border p-2" type="text" id="invoiceNo" placeholder="Invoice Number (e.g. INV-1001)" required>
      <input class="border p-2" type="date" id="invoiceDate" required>
      <input class="border p-2" type="text" id="clientName" placeholder="Client Name" required>
      <input class="border p-2" type="text" id="clientPhone" placeholder="Client Phone">
      <input class="border p-2 col-span-2" type="text" id="clientAddress" placeholder="Client Address" required>
      <textarea class="border p-2 col-span-2" id="description" placeholder="Service Description"></textarea>
      <input class="border p-2" type="number" id="price" placeholder="Price (Rs)" required>
      <input class="border p-2" type="number" id="discount" placeholder="Discount (Rs)" value="0">
      <input class="border p-2" type="number" id="advance" placeholder="Advance Paid (Rs)" value="0">
      <input class="border p-2" type="number" id="finalPayment" placeholder="Final Payment (Rs)" value="0">
    </form>
    <button onclick="generateInvoice()" class="btn btn-primary mt-4">Generate Invoice</button>
  </div>

  <!-- Invoice Preview -->
  <div id="invoicePreview" class="invoice-box hidden">
    <div id="invoiceContent">

      <!-- Header -->
      <div class="flex justify-between items-center mb-6">
        <img id="pCompanyLogo" alt="Company Logo" class="h-14 hidden">
        <h1 id="pCompanyName" class="text-2xl font-bold text-blue-800"></h1>
        <h1 class="text-3xl font-bold text-blue-800">INVOICE</h1>
      </div>

      <!-- Billed To -->
      <div class="mb-4">
        <h2 class="text-lg font-semibold">Billed To:</h2>
        <p id="pClientName" class="font-bold text-blue-700"></p>
        <p id="pClientAddress"></p>
        <p id="pClientPhone"></p>
      </div>

      <!-- Invoice Details -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <p><b>Invoice Number:</b> <span id="pInvoiceNo"></span></p>
        <p><b>Date:</b> <span id="pInvoiceDate"></span></p>
      </div>

      <!-- Service Table -->
      <table id="invoiceTable">
        <thead>
          <tr>
            <th>Particulars</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="invoiceBody"></tbody>
      </table>

      <!-- Status -->
      <div class="mt-4">
        <p id="pStatus"></p>
      </div>

      <!-- Footer -->
      <p class="mt-8 text-center text-blue-700 font-semibold">Thank you for your business!</p>
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 text-center">
      <button onclick="downloadPDF()" class="btn btn-primary">Download PDF</button>
      <button onclick="shareWhatsApp()" class="btn btn-secondary">Share WhatsApp</button>
      <button onclick="shareEmail()" class="btn btn-warning">Share Email</button>
      <button onclick="shareNative()" class="btn btn-share">Share More Apps</button>
    </div>
  </div>

<script>
  function generateInvoice() {
    let companyName = document.getElementById('companyName').value;
    let companyLogoFile = document.getElementById('companyLogoFile').files[0];
    let companyLogoURL = document.getElementById('companyLogoURL').value;

    let invoiceNo = document.getElementById('invoiceNo').value;
    let invoiceDate = document.getElementById('invoiceDate').value || new Date().toLocaleDateString();
    let clientName = document.getElementById('clientName').value;
    let clientAddress = document.getElementById('clientAddress').value;
    let clientPhone = document.getElementById('clientPhone').value;
    let description = document.getElementById('description').value;
    let price = parseFloat(document.getElementById('price').value) || 0;
    let discount = parseFloat(document.getElementById('discount').value) || 0;
    let advance = parseFloat(document.getElementById('advance').value) || 0;
    let finalPayment = parseFloat(document.getElementById('finalPayment').value) || 0;

    let total = price - discount;
    let totalPaid = advance + finalPayment;
    let pending = total - totalPaid;

    // Company Info
    document.getElementById('pCompanyName').innerText = companyName;
    let logoElement = document.getElementById('pCompanyLogo');

    if (companyLogoFile) {
      let reader = new FileReader();
      reader.onload = function(e) {
        logoElement.src = e.target.result;
        logoElement.classList.remove("hidden");
      }
      reader.readAsDataURL(companyLogoFile);
    } else if (companyLogoURL.trim() !== "") {
      logoElement.src = companyLogoURL;
      logoElement.classList.remove("hidden");
    } else {
      logoElement.classList.add("hidden");
    }

    // Invoice Info
    document.getElementById('pInvoiceNo').innerText = invoiceNo;
    document.getElementById('pInvoiceDate').innerText = invoiceDate;
    document.getElementById('pClientName').innerText = clientName;
    document.getElementById('pClientAddress').innerText = clientAddress;
    document.getElementById('pClientPhone').innerText = clientPhone;

    let rows = "";
    rows += `<tr><td>${description}</td><td>Rs ${price}</td></tr>`;
    if (discount > 0) rows += `<tr><td>Discount</td><td>- Rs ${discount}</td></tr>`;
    rows += `<tr><td><b>Total</b></td><td><b>Rs ${total}</b></td></tr>`;

    let statusText = "";

    if (advance > 0 && finalPayment > 0 && totalPaid === total) {
      rows += `<tr><td>Advance Paid</td><td>Rs ${advance}</td></tr>`;
      rows += `<tr><td>Final Payment</td><td>Rs ${finalPayment}</td></tr>`;
      statusText = `<span class="status-paid">✅ Cleared Dues</span>`;
    } else if (totalPaid === total) {
      rows += `<tr><td>Paid Amount</td><td>Rs ${totalPaid}</td></tr>`;
      statusText = `<span class="status-paid">✅ Paid in Full</span>`;
    } else if (advance > 0 && pending > 0) {
      rows += `<tr><td>Advance</td><td>Rs ${advance}</td></tr>`;
      rows += `<tr><td>Pending</td><td>Rs ${pending}</td></tr>`;
      statusText = `<span class="status-partial">⚠️ Partial Payment</span>`;
    } else if (totalPaid === 0) {
      rows += `<tr><td>Pending</td><td>Rs ${total}</td></tr>`;
      statusText = `<span class="status-none">❌ No Payment Made</span>`;
    }

    document.getElementById('invoiceBody').innerHTML = rows;
    document.getElementById('pStatus').innerHTML = statusText;

    document.getElementById('invoicePreview').classList.remove('hidden');
  }

  function downloadPDF() {
    const element = document.getElementById("invoiceContent");
    const invoiceNo = document.getElementById('invoiceNo').value || "invoice";

    const opt = {
      margin: [15, 15, 15, 15],
      filename: `${invoiceNo}.pdf`,
      image: { type: 'jpeg', quality: 1 },
      html2canvas: { scale: 4, useCORS: true },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    element.style.borderRadius = "20px";
    element.style.boxShadow = "0 6px 20px rgba(0,0,0,0.12)";

    html2pdf().set(opt).from(element).save().finally(() => {
      element.style.borderRadius = "";
      element.style.boxShadow = "";
    });
  }

  function shareWhatsApp() {
    alert("For B2B: Please download invoice and share on WhatsApp manually.");
  }
  function shareEmail() {
    alert("For B2B: Please download invoice and attach in your email manually.");
  }
  function shareNative() {
    alert("For B2B: Please download invoice and share via your preferred app.");
  }
</script>

</body>
</html>
