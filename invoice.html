<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Solo2CEO Invoice Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Arial', sans-serif; background: #f1f5f9; }
    .invoice-box { background: #fff; padding: 30px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 850px; margin: auto; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #d1d5db; padding: 10px; text-align: left; }
    th { background: #f3f4f6; }
    .btn { padding: 10px 15px; border-radius: 8px; margin: 5px; font-weight: bold; cursor: pointer; }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-secondary { background: #16a34a; color: #fff; }
    .btn-warning { background: #eab308; color: #fff; }
    .btn-share { background: #f97316; color: #fff; }
    .status-paid { color: green; font-weight: bold; }
    .status-partial { color: orange; font-weight: bold; }
    .status-none { color: red; font-weight: bold; }
    .ribbon a {
  position: relative;
  display: inline-block;
  text-decoration: none;
  transition: all 0.3s ease;
}

.ribbon a::before {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  border-width: 0 10px 10px 0;
  border-style: solid;
  border-color: #b91c1c transparent transparent transparent;
  transform: rotate(45deg);
}
.ribbon a:hover {
  transform: scale(1.05);
}

  </style>
</head>
<body class="p-6">

  <h2 class="text-center text-3xl font-bold mb-6 text-blue-700">Solo2CEO Invoice Generator</h2>

  <!-- Invoice Form -->
  <div class="invoice-box mb-6 relative">
     <!-- Ribbon for Previous Invoices -->
    <div class="ribbon absolute top-0 right-0 m-4">
        <a href="https://drive.google.com/drive/folders/1Z0VwkJnMDiu-rbaHu7eCfLYY0savkoGs" target="_blank" class="bg-red-500 text-white px-3 py-1 rounded shadow hover:bg-red-600 font-bold text-sm">
            My Invoices
        </a>
    </div>
    <h3 class="font-bold text-lg mb-4 border-b pb-2">Fill Invoice Details</h3>
    <form id="invoiceForm" class="grid grid-cols-2 gap-4">
      <input class="border p-2" type="text" id="invoiceNo" placeholder="Invoice Number (e.g. INV-1001)" required>
      <input class="border p-2" type="date" id="invoiceDate" required>
      <input class="border p-2" type="text" id="clientName" placeholder="Client Name" required>
      <input class="border p-2" type="text" id="clientPhone" placeholder="Client Phone">
      <input class="border p-2 col-span-2" type="text" id="clientAddress" placeholder="Client Address" required>
      <textarea class="border p-2 col-span-2" id="description" placeholder="Service Description"></textarea>
      <input class="border p-2" type="number" id="price" placeholder="Price (Rs)" required>
      <input class="border p-2" type="number" id="discount" placeholder="Discount (Rs)" value="0">
      <input class="border p-2" type="number" id="advance" placeholder="Advance Paid (Rs)" value="0">
      <input class="border p-2" type="number" id="finalPayment" placeholder="Final Payment (Rs)" value="0">
    </form>
    <button onclick="generateInvoice()" class="btn btn-primary mt-4">Generate Invoice</button>
  </div>
  

  <!-- Invoice Preview -->
  <div id="invoicePreview" class="invoice-box hidden">
    <div id="invoiceContent">
       
      <!-- Header -->
      <div class="flex justify-between items-center mb-6">
        <img src="./image/Solo2ceologo.png" alt="Solo2CEO Logo" class="h-14">
        <h1 class="text-3xl font-bold text-blue-800">INVOICE</h1>
      </div>

      <!-- Billed To -->
      <div class="mb-4">
        <h2 class="text-lg font-semibold">Billed To:</h2>
        <p id="pClientName" class="font-bold text-blue-700"></p>
        <p id="pClientAddress"></p>
        <p id="pClientPhone"></p>
      </div>

      <!-- Invoice Details -->
      <div class="grid grid-cols-2 gap-4 mb-4">
        <p><b>Invoice Number:</b> <span id="pInvoiceNo"></span></p>
        <p><b>Date:</b> <span id="pInvoiceDate"></span></p>
      </div>

      <!-- Service Table -->
      <table id="invoiceTable">
        <thead>
          <tr>
            <th>Particulars</th>
            <th>Amount</th>
          </tr>
        </thead>
        <tbody id="invoiceBody"></tbody>
      </table>

      <!-- Status -->
      <div class="mt-4">
        <p id="pStatus"></p>
      </div>

      <!-- Payment Details -->
      <div class="mt-6">
        <h3 class="font-bold text-lg border-b pb-1">Payment Details</h3>
        <p><b>Account Holder:</b> Arman Khan</p>
        <p><b>Bank:</b> Au Small Finance Bank</p>
        <p><b>Account Number:</b> 2401252159545917</p>
        <p><b>IFSC:</b> AUBL0002521</p>
        <p><b>Branch:</b> Chakala, Andheri East, Mumbai 59</p>
        <p><b>UPI ID:</b> 8850102255@ptaxis</p>
      </div>

      <!-- Footer -->
      <p class="mt-8 text-center text-blue-700 font-semibold">Thank you for choosing Solo2CEO</p>
    </div>

    <!-- Action Buttons -->
    <div class="mt-6 text-center">
      <button onclick="downloadPDF()" class="btn btn-primary">Download PDF</button>
      <button onclick="shareWhatsApp()" class="btn btn-secondary">Share WhatsApp</button>
      <button onclick="shareEmail()" class="btn btn-warning">Share Email</button>
      <button onclick="shareNative()" class="btn btn-share">Share More Apps</button>
    </div>
  </div>

<script>
  function generateInvoice() {
    let invoiceNo = document.getElementById('invoiceNo').value;
    let invoiceDate = document.getElementById('invoiceDate').value || new Date().toLocaleDateString();
    let clientName = document.getElementById('clientName').value;
    let clientAddress = document.getElementById('clientAddress').value;
    let clientPhone = document.getElementById('clientPhone').value;
    let description = document.getElementById('description').value;
    let price = parseFloat(document.getElementById('price').value) || 0;
    let discount = parseFloat(document.getElementById('discount').value) || 0;
    let advance = parseFloat(document.getElementById('advance').value) || 0;
    let finalPayment = parseFloat(document.getElementById('finalPayment').value) || 0;

    let total = price - discount;
    let totalPaid = advance + finalPayment;
    let pending = total - totalPaid;

    // Fill values in preview
    document.getElementById('pInvoiceNo').innerText = invoiceNo;
    document.getElementById('pInvoiceDate').innerText = invoiceDate;
    document.getElementById('pClientName').innerText = clientName;
    document.getElementById('pClientAddress').innerText = clientAddress;
    document.getElementById('pClientPhone').innerText = clientPhone;

    let rows = "";
    rows += `<tr><td>${description}</td><td>Rs ${price}</td></tr>`;
    if (discount > 0) rows += `<tr><td>Discount</td><td>- Rs ${discount}</td></tr>`;
    rows += `<tr><td><b>Total</b></td><td><b>Rs ${total}</b></td></tr>`;

    let statusText = "";

    if (advance > 0 && finalPayment > 0 && totalPaid === total) {
      rows += `<tr><td>Advance Paid</td><td>Rs ${advance}</td></tr>`;
      rows += `<tr><td>Final Payment</td><td>Rs ${finalPayment}</td></tr>`;
      rows += `<tr><td>Pending</td><td>Rs 0</td></tr>`;
      statusText = `<span class="status-paid">✅ Cleared Dues</span>`;
    } else if (totalPaid === total) {
      rows += `<tr><td>Paid Amount</td><td>Rs ${totalPaid}</td></tr>`;
      statusText = `<span class="status-paid">✅ Paid in Full</span>`;
    } else if (advance > 0 && pending > 0) {
      rows += `<tr><td>Advance</td><td>Rs ${advance}</td></tr>`;
      rows += `<tr><td>Pending</td><td>Rs ${pending}</td></tr>`;
      statusText = `<span class="status-partial">⚠️ Partial Payment</span>`;
    } else if (totalPaid === 0) {
      rows += `<tr><td>Pending</td><td>Rs ${total}</td></tr>`;
      statusText = `<span class="status-none">❌ No Payment Made</span>`;
    }

    document.getElementById('invoiceBody').innerHTML = rows;
    document.getElementById('pStatus').innerHTML = statusText;

    document.getElementById('invoicePreview').classList.remove('hidden');
  }

  function downloadPDF() {
  const element = document.getElementById("invoiceContent");
  const invoiceNo = document.getElementById('invoiceNo').value || "invoice";

  // Remove Pending row if amount is 0
  const invoiceBody = element.querySelector("#invoiceBody");
  for (let i = invoiceBody.rows.length - 1; i >= 0; i--) {
    let row = invoiceBody.rows[i];
    if (row.cells[0].innerText.toLowerCase() === "pending") {
      let amountText = row.cells[1].innerText.replace(/[^0-9.-]+/g,"");
      if (parseFloat(amountText) === 0) {
        row.remove(); // Remove Pending row
        // Update status to Cleared Dues
        const statusElement = element.querySelector("#pStatus");
        statusElement.innerHTML = `<span class="status-paid">✅ Cleared Dues</span>`;
      }
    }
  }

  const opt = {
    margin: [15, 15, 15, 15], // top, left, bottom, right in mm
    filename: `${invoiceNo}.pdf`,
    image: { type: 'jpeg', quality: 1 },
    html2canvas: { scale: 4, useCORS: true, logging: true, letterRendering: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  // Apply temporary styling for PDF rendering
  element.style.borderRadius = "20px";
  element.style.boxShadow = "0 6px 20px rgba(0,0,0,0.12)";

  html2pdf().set(opt).from(element).save().finally(() => {
    element.style.borderRadius = "";
    element.style.boxShadow = "";
  });
}



  async function shareWhatsApp() {
  const element = document.getElementById("invoiceContent");
  const invoiceNo = document.getElementById('invoiceNo').value || "invoice";

  const opt = {
    margin: [15, 15, 15, 15],
    filename: `${invoiceNo}.pdf`,
    image: { type: 'jpeg', quality: 1 },
    html2canvas: { scale: 3, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  // Generate PDF blob
  const pdfBlob = await html2pdf().set(opt).from(element).outputPdf('blob');
  const file = new File([pdfBlob], `${invoiceNo}.pdf`, { type: "application/pdf" });

  if (navigator.canShare && navigator.canShare({ files: [file] })) {
    await navigator.share({
      title: "Invoice",
      text: "Here is your invoice from Solo2CEO",
      files: [file]
    });
  } else {
    // Fallback → Upload PDF to server or show download link
    alert("Your browser/device does not support direct WhatsApp file sharing. Please download and share manually.");
  }
}

async function shareEmail() {
  const element = document.getElementById("invoiceContent");
  const invoiceNo = document.getElementById('invoiceNo').value || "invoice";

  const opt = {
    margin: [15, 15, 15, 15],
    filename: `${invoiceNo}.pdf`,
    image: { type: 'jpeg', quality: 1 },
    html2canvas: { scale: 3, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  // Generate PDF blob
  const pdfBlob = await html2pdf().set(opt).from(element).outputPdf('blob');
  const file = new File([pdfBlob], `${invoiceNo}.pdf`, { type: "application/pdf" });

  if (navigator.canShare && navigator.canShare({ files: [file] })) {
    await navigator.share({
      title: "Invoice",
      text: "Please find attached invoice.",
      files: [file]
    });
  } else {
    // Fallback: Open default mail client with subject/body, user attaches PDF manually
    let subject = "Invoice from Solo2CEO";
    let body = "Please find your invoice attached. (Download it from the app and attach manually if not auto-attached)";
    window.location.href = "mailto:?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body);
  }
}

</script>

</body>
</html>
