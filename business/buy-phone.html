  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>NextPhone ‚Äî Modern Mobile Store</title>

    <!-- PapaParse for CSV -->
    <script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>

    <style>
      /* ---------- Base / Utility ---------- */
      :root{
        --bg:#f4f6f9;
        --card:#ffffff;
        --accent:#0077b6;
        --accent-strong:#023e8a;
        --success:#25d366;
        --muted:#6b7280;
        --glass: rgba(255,255,255,0.6);
        --radius:14px;
        --shadow: 0 8px 30px rgba(15,23,42,0.08);
        --max-width:1200px;
      }
      html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
      body{background:var(--bg); color:#0f172a; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
      a{color:inherit}
      .container{max-width:var(--max-width);margin:20px auto;padding:0 16px;}

      /* ---------- Header ---------- */
      header.topbar{
        background:linear-gradient(90deg,var(--accent),var(--accent-strong));
        border-radius:12px;
        padding:14px;
        color:white;
        display:flex;
        gap:12px;
        align-items:center;
        justify-content:space-between;
        box-shadow:var(--shadow);
      }
      .brand {display:flex; gap:12px; align-items:center;}
      .brand .logo{
        width:44px;height:44px;border-radius:10px;background:rgba(255,255,255,0.12);
        display:grid;place-items:center;font-weight:700;font-size:20px;
      }
      .brand h1{margin:0;font-size:1.1rem;letter-spacing:0.2px}
      .controls{display:flex;gap:12px;align-items:center;}

      /* Hamburger / Cart button */
      .cart-btn{
        background:rgba(255,255,255,0.12);
        color:white;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;
        display:flex;gap:10px;align-items:center;font-weight:600;
      }
      .cart-bubble{background:var(--success);color:white;padding:4px 8px;border-radius:999px;font-weight:700;font-size:0.85rem}

      /* ---------- Filters ---------- */
      .filters{
        display:flex;gap:12px;align-items:center;margin-top:18px;padding:14px;background:var(--card);
        border-radius:12px; box-shadow: 0 6px 20px rgba(2,6,23,0.04);
        flex-wrap:wrap;
      }
      .filters .search{
        flex:1;min-width:200px;display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid #e6edf3;background:white;
      }
      .filters input[type="search"]{border:0;outline:0;font-size:0.95rem;background:transparent;width:100%;}
      .filters select, .filters .sort {
        padding:8px 12px;border-radius:10px;border:1px solid #e6edf3;background:white;font-size:0.95rem;
      }

      /* ---------- Product Grid ---------- */
      .grid{
        display:grid;
        grid-template-columns: repeat(4, 1fr);
        gap:20px;
        margin-top:18px;
      }
      /* responsive */
      @media(max-width:1100px){ .grid{grid-template-columns: repeat(3,1fr);} }
      @media(max-width:800px){ .grid{grid-template-columns: repeat(2,1fr);} }
      @media(max-width:520px){ .grid{grid-template-columns: 1fr;} .filters{flex-direction:column;align-items:stretch} }

      .card{
        background:var(--card);border-radius:12px;padding:0;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;
        transition: transform .22s ease, box-shadow .22s ease;
      }
      .card:hover{ transform: translateY(-6px); box-shadow: 0 16px 36px rgba(15,23,42,0.12); }

      .card-media{
        width:100%;background:#fafafa;border-bottom:1px solid #f0f4f8;display:grid;place-items:center;padding:12px 16px;
      }
      .card-media img{ max-width:100%; height:220px; object-fit:contain; } /* shows full image */

      .card-body{ padding:14px; display:flex;flex-direction:column; gap:8px; }
      .title{ font-weight:700; font-size:1rem; color:#0b1220; display:flex; justify-content:space-between; align-items:center; gap:10px;}
      .meta{ font-size:0.85rem;color:var(--muted); }
      .desc{ font-size:0.9rem;color:#263244; min-height:38px; overflow:hidden; }
      .price{ font-weight:800;color:#d5393b;font-size:1.05rem; }
      .stock{ font-size:0.85rem; color:var(--muted); }
      .card-footer{display:flex;gap:8px;align-items:center;margin-top:8px;}
      .qty-input{ width:74px;padding:8px;border-radius:8px;border:1px solid #e6edf3;background:#fff;font-weight:600;text-align:center; }

      .btn-primary{
        background:var(--accent); color:white;border:0;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:700;
        transition: background .18s;
      }
      .btn-primary[disabled]{opacity:0.55;cursor:not-allowed}
      .btn-outline{ background:transparent;border:1px solid #e6edf3;padding:8px 10px;border-radius:10px;cursor:pointer; }

      /* ---------- Cart Drawer (desktop right / mobile bottom) ---------- */
      .overlay {
        position:fixed;inset:0;background:rgba(2,6,23,0.35);opacity:0;visibility:hidden;transition:opacity .2s;z-index:900;
      }
      .overlay.visible{opacity:1;visibility:visible;}
      .cart-drawer{
        position:fixed;right:0;top:0;height:100%;width:420px;background:linear-gradient(180deg,#fff,#fafafa);
        box-shadow:-8px 0 40px rgba(2,6,23,0.12);transform:translateX(110%);transition:transform .28s;z-index:1000;border-radius: 14px 0 0 14px;;
        display:flex;flex-direction:column;padding:18px;
      }
      .cart-drawer.open{ transform:translateX(0); }
      @media(max-width:780px){
        .cart-drawer{ right:0; left:0; width:auto; height:55%; bottom:0; top:auto; border-radius:14px 14px 0 0; transform:translateY(110%); }
        .cart-drawer.open{ transform:translateY(0); }
      }

      .cart-head{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:8px; }
      .cart-list{ overflow:auto; flex:1;padding-right:6px; }
      .cart-row{ display:flex; justify-content:space-between; align-items:center; gap:8px; padding:10px 0; border-bottom:1px dashed #eef2f6;}
      .cart-row .name{ font-weight:700; }
      .cart-row .controls{ display:flex; gap:8px; align-items:center; }
      .small { font-size:0.85rem;color:var(--muted); }

      .cart-empty{ text-align:center;color:var(--muted); padding:40px 10px; }

      .cart-footer{ padding-top:10px; border-top:1px solid rgba(8,15,25,0.04); display:flex; flex-direction:column; gap:10px; }
      .checkout-btn{ background:var(--success); color:white;padding:12px;border-radius:10px;text-align:center;font-weight:800;border:0; cursor:pointer; text-decoration:none;}
      .secondary-btn{ background:transparent;border:1px solid #e6edf3;padding:10px;border-radius:10px;cursor:pointer; }

      /* small helpers */
      .muted{ color:var(--muted); font-size:0.9rem; }
      .pill{ background:#f1f5f9;color:#0b1220;padding:6px 10px;border-radius:999px;font-weight:700;font-size:0.85rem; }


      .brand {
    display: flex;
    align-items: center;
    gap: 15px; /* space between logo and text */
    padding: 10px 20px;
    background-color: #f8f9fa; /* soft background */
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    max-width: 400px;
  }

  .logo img {
    height: 60px; /* adjust size */
    width: auto;
    border-radius: 10px; /* subtle rounded corners */
  }

  .brand-text h1 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c3e50;
  }

  .brand-text .tagline {
    margin: 2px 0 0 0;
    font-size: 0.9rem;
    color: #7f8c8d;
    font-weight: 500;
  }

    </style>
  </head>
  <body>

    <div class="container">
      <!-- Header -->
      <header class="topbar" role="banner">
        <!-- Logo Section -->
  <div class="brand">
    <div class="logo">
      <img src="../image/NextPhone.png" alt="MediCart Logo">
    </div>
    <div class="brand-text">
      <h1>     </h1>
      <!-- <p class="tagline">Simple ordering ‚Äî WhatsApp checkout</p> -->
    </div>
  </div>


        <div class="controls">
          <div class="pill small" id="totalAmountPill">Total: ‚Çπ0</div>
          <button id="hamburger" aria-label="Open cart" class="cart-btn">
            üõí <span id="cartBubbleText">Cart</span>
            <span class="cart-bubble" id="cartBubbleCount">0</span>
          </button>
        </div>
      </header>

      <!-- Filters -->
      <div class="filters" role="region" aria-label="Filters">
        <div class="search" title="Search">
          üîé <input id="searchInput" type="search" placeholder="Search product name or description..." aria-label="Search products" />
        </div>

        <select id="categoryFilter" aria-label="Filter by category">
          <option value="">All categories</option>
        </select>

        <select id="sortSelect" class="sort" aria-label="Sort products">
          <option value="relevance">Sort: Relevance</option>
          <option value="price-asc">Price: Low ‚Üí High</option>
          <option value="price-desc">Price: High ‚Üí Low</option>
          <option value="name-asc">Name: A ‚Üí Z</option>
        </select>
      </div>

      <!-- Grid -->
      <div id="cardsContainer" class="grid" aria-live="polite"></div>
    </div>

    <!-- Overlay + Cart Drawer -->
    <div id="overlay" class="overlay" tabindex="-1" aria-hidden="true"></div>

    <aside id="cartDrawer" class="cart-drawer" role="dialog" aria-label="Shopping cart">
      <div class="cart-head">
        <div>
          <div style="font-weight:800;font-size:1.05rem">Your Cart</div>
          <div class="small muted" id="cartSummarySmall">0 items</div>
        </div>
        <div>
          <button id="closeCart" class="secondary-btn">Close</button>
        </div>
      </div>

      <div class="cart-list" id="cartItemsContainer">
        <div class="cart-empty" id="cartEmptyMsg">Your cart is empty. Add items to get started.</div>
      </div>

      <div class="cart-footer">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="muted">Subtotal</div>
          <div style="font-weight:900" id="cartTotalDisplay">‚Çπ0</div>
        </div>
        <a id="checkoutBtn" class="checkout-btn" href="#" target="_blank">Checkout via WhatsApp</a>
        <button id="clearCartBtn" class="secondary-btn">Clear cart</button>
      </div>
    </aside>

    <!-- ---------- Script ---------- -->
    <script>
    // ---------- Configuration ----------
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQVR8aI_QGT7naJQgDZfvjf_mVERKwHYq3iSvmWlhgVX491BAjGl50yBGazplyx41GAxnKnwAGtnty4/pub?output=csv";
    const whatsappNumber = "917021360582";

    // ---------- State ----------
    let allData = [];
    let filteredData = [];
    let cart = JSON.parse(localStorage.getItem("medicart_cart") || "[]");

    // DOM refs
    const cardsContainer = document.getElementById("cardsContainer");
    const categoryFilter = document.getElementById("categoryFilter");
    const searchInput = document.getElementById("searchInput");
    const sortSelect = document.getElementById("sortSelect");
    const overlay = document.getElementById("overlay");
    const cartDrawer = document.getElementById("cartDrawer");
    const hamburger = document.getElementById("hamburger");
    const closeCart = document.getElementById("closeCart");
    const cartBubbleCount = document.getElementById("cartBubbleCount");
    const cartBubbleText = document.getElementById("cartBubbleText");
    const cartItemsContainer = document.getElementById("cartItemsContainer");
    const cartTotalDisplay = document.getElementById("cartTotalDisplay");
    const totalAmountPill = document.getElementById("totalAmountPill");
    const cartSummarySmall = document.getElementById("cartSummarySmall");
    const checkoutBtn = document.getElementById("checkoutBtn");
    const clearCartBtn = document.getElementById("clearCartBtn");

    // ---------- Helpers ----------
    function debounce(fn, delay=250){
      let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args),delay); }
    }
    function parsePrice(p){ return Number(String(p||'').replace(/[^0-9.-]+/g,"")) || 0; }
    function formatNumber(n){ return Number(n).toLocaleString('en-IN'); }
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }
    function placeholderDataURI(){ return "data:image/svg+xml;charset=UTF-8,"+encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='600' height='420'><rect width='100%' height='100%' fill='#f3f4f6'/><text x='50%' y='50%' fill='#999' font-size='22' font-family='Arial' dominant-baseline='middle' text-anchor='middle'>No image</text></svg>`); }
    function shakeElement(el){ el.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}],{duration:260}); }

    // ---------- Fetch from Google Sheet ----------
    Papa.parse(sheetUrl, {
      download:true, header:true, skipEmptyLines:true,
      complete: function(results){
        if (!results.data || results.data.length===0){
          cardsContainer.innerHTML = `<div style="padding:36px;text-align:center;color:red">‚ùå No products found in sheet</div>`;
          return;
        }
        allData = results.data.map((r,i)=>({
          id: String(r['ID'] ?? i),
          name: (r['Product Name'] ?? '').trim(),
          category: (r['Category'] ?? '').trim(),
          description: (r['Description'] ?? '').trim(),
          price: parsePrice(r['Price (‚Çπ)'] ?? r['Price']),
          priceRaw: r['Price (‚Çπ)'] ?? r['Price'] ?? '0',
          image: (r['Image URL'] ?? '').trim(),
          stock: Number(r['Stock'] ?? 0),
          status: (r['Status'] ?? 'Active').trim()
        })).filter(p=>p.name && p.status.toLowerCase()!=='inactive');

        filteredData=[...allData];
        populateCategoryFilter();
        renderCards(filteredData);
        syncCartButtons();
        renderCart();
        console.log("‚úÖ Products Loaded:", allData);
      },
      error: function(err){
        cardsContainer.innerHTML = `<div style="padding:36px;text-align:center;color:red">‚ùå Error loading sheet: ${err}</div>`;
      }
    });

    // ---------- Render Product Cards ----------
    function renderCards(data){
      cardsContainer.innerHTML="";
      if (!data.length){
        cardsContainer.innerHTML = `<div style="padding:36px;text-align:center;color:gray">No products found</div>`;
        return;
      }
      data.forEach(p=>{
        const inStock = p.stock>0;
        const existingQty = getCartItemQtyById(p.id);
        const card=document.createElement("div");
        card.className="card";
        card.innerHTML=`
          <div class="card-media">
            <img loading="lazy" src="${escapeHtml(p.image)||placeholderDataURI()}" alt="${escapeHtml(p.name)}" onerror="this.onerror=null;this.src='${placeholderDataURI()}';">
          </div>
          <div class="card-body">
            <div class="title">
              <span>${escapeHtml(p.name)}</span>
              <span class="small muted">${escapeHtml(p.category)}</span>
            </div>
            <div class="meta price">‚Çπ${formatNumber(p.price)}</div>
            <div class="desc">${escapeHtml(p.description)}</div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;">
              <div class="stock">${inStock?`In stock: ${p.stock}`:"<span style='color:#c02626'>Out of stock</span>"}</div>
              <div style="display:flex;gap:8px;align-items:center">
                <input class="qty-input" id="qty-input-${p.id}" type="number" min="1" value="1" ${!inStock?'disabled style="opacity:.6"':''}>
                <button id="btn-${p.id}" class="btn-primary" ${!inStock?'disabled':''}>${existingQty?'Added ‚úÖ':'Add to cart'}</button>
              </div>
            </div>
          </div>`;
        cardsContainer.appendChild(card);
        document.getElementById(`btn-${p.id}`).addEventListener('click',()=>{
          const qtyInput=document.getElementById(`qty-input-${p.id}`);
          const qty=Math.max(1,Number(qtyInput.value)||1);
          addToCartById(p.id,qty);
          syncCardButtonById(p.id,true);
          shakeElement(document.getElementById(`btn-${p.id}`));
        });
      });
    }

    // ---------- Filters ----------
    function populateCategoryFilter(){
      const cats=[...new Set(allData.map(p=>p.category).filter(Boolean))].sort();
      cats.forEach(c=>{ let o=document.createElement('option');o.value=c;o.textContent=c;categoryFilter.appendChild(o); });
    }
    const applySearchFilterSort=debounce(()=>{
      const q=(searchInput.value||'').toLowerCase();
      const cat=categoryFilter.value;
      const sort=sortSelect.value;
      filteredData=allData.filter(p=>{
        const mc=!cat||p.category===cat;
        const mq=!q||p.name.toLowerCase().includes(q)||p.description.toLowerCase().includes(q)||p.category.toLowerCase().includes(q);
        return mc&&mq;
      });
      if (sort==='price-asc') filteredData.sort((a,b)=>a.price-b.price);
      else if (sort==='price-desc') filteredData.sort((a,b)=>b.price-a.price);
      else if (sort==='name-asc') filteredData.sort((a,b)=>a.name.localeCompare(b.name));
      renderCards(filteredData); syncCartButtons();
    },200);
    searchInput.addEventListener('input',applySearchFilterSort);
    categoryFilter.addEventListener('change',applySearchFilterSort);
    sortSelect.addEventListener('change',applySearchFilterSort);

    // ---------- Cart ----------
    function getCartItemIndexById(id){ return cart.findIndex(it=>String(it.id)===String(id)); }
    function getCartItemQtyById(id){ const i=getCartItemIndexById(id); return i>=0?cart[i].qty:0; }
    function persistCart(){ localStorage.setItem("medicart_cart",JSON.stringify(cart)); }
    function addToCartById(id,qty=1){
      const prod=allData.find(it=>String(it.id)===String(id)); if(!prod||prod.stock<=0) return;
      const idx=getCartItemIndexById(id);
      if(idx===-1){ cart.push({...prod,qty}); } else { cart[idx].qty=Math.min(cart[idx].qty+qty,prod.stock); }
      persistCart(); renderCart(); openCartDrawer();
    }
    function removeFromCartById(id){ const i=getCartItemIndexById(id); if(i>=0)cart.splice(i,1); persistCart(); renderCart(); syncCardButtonById(id,false); }
    function setQtyInCart(id,qty){ const i=getCartItemIndexById(id); if(i<0)return; if(qty<=0){removeFromCartById(id);return;} const max=allData.find(it=>String(it.id)===String(id))?.stock||Infinity; cart[i].qty=Math.min(qty,max); persistCart(); renderCart(); }
    function clearCart(){ cart=[]; persistCart(); renderCart(); }

    function renderCart(){
      const totalItems=cart.reduce((s,it)=>s+it.qty,0);
      const totalPrice=cart.reduce((s,it)=>s+(it.price*it.qty),0);
      cartBubbleCount.textContent=totalItems;
      cartSummarySmall.textContent=`${totalItems} item${totalItems!==1?'s':''}`;
      cartTotalDisplay.textContent=`‚Çπ${formatNumber(totalPrice)}`;
      totalAmountPill.textContent=`Total: ‚Çπ${formatNumber(totalPrice)}`;
      cartItemsContainer.innerHTML="";
      if(!cart.length){
        cartItemsContainer.innerHTML=`<div class="cart-empty"><div style="font-weight:800">Cart is empty</div><div class="small muted">Add products to place an order</div></div>`;
      } else {
        cart.forEach(it=>{
          const row=document.createElement("div");
          row.className="cart-row";
          row.innerHTML=`
            <div style="flex:1;min-width:0;">
              <div class="name">${escapeHtml(it.name)}</div>
              <div class="small muted">‚Çπ${formatNumber(it.price)} x ${it.qty} = <strong>‚Çπ${formatNumber(it.price*it.qty)}</strong></div>
            </div>
            <div class="controls">
              <button class="btn-outline" data-action="dec" data-id="${it.id}">‚àí</button>
              <div class="pill">${it.qty}</div>
              <button class="btn-outline" data-action="inc" data-id="${it.id}">+</button>
              <button class="btn-outline" data-action="remove" data-id="${it.id}">Remove</button>
            </div>`;
          cartItemsContainer.appendChild(row);
        });
      }
      checkoutBtn.href=`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(buildWhatsAppMessage())}`;
      cartBubbleText.textContent="Cart";
      syncCartButtons();
    }

    cartItemsContainer.addEventListener('click',e=>{
      const btn=e.target.closest('button'); if(!btn)return;
      const {action,id}=btn.dataset;
      if(action==='inc'){ const i=getCartItemIndexById(id); if(i>=0) setQtyInCart(id,cart[i].qty+1); }
      if(action==='dec'){ const i=getCartItemIndexById(id); if(i>=0) setQtyInCart(id,cart[i].qty-1); }
      if(action==='remove'){ removeFromCartById(id); }
    });

    // ---------- Cart Drawer ----------
    function syncCartButtons(){ cart.forEach(it=>syncCardButtonById(it.id,true)); }
    function syncCardButtonById(id,added){ const btn=document.getElementById(`btn-${id}`); if(btn) btn.textContent=added?'Added ‚úÖ':'Add to cart'; }
    function openCartDrawer(){ overlay.classList.add('visible'); cartDrawer.classList.add('open'); overlay.setAttribute('aria-hidden','false'); }
    function closeCartDrawer(){ overlay.classList.remove('visible'); cartDrawer.classList.remove('open'); overlay.setAttribute('aria-hidden','true'); }
    hamburger.addEventListener('click',()=>{ cartDrawer.classList.contains('open')?closeCartDrawer():openCartDrawer(); });
    closeCart.addEventListener('click',closeCartDrawer);
    overlay.addEventListener('click',closeCartDrawer);
    clearCartBtn.addEventListener('click',()=>{ if(confirm('Clear the cart?')){ clearCart(); closeCartDrawer(); } });

    // ---------- WhatsApp ----------
    function buildWhatsAppMessage(){
      if(!cart.length) return "Hello, I'd like to order but my cart is empty.";
      let lines=["Hello, I would like to place an order:"];
      cart.forEach(it=>lines.push(`${it.name} ‚Äî ‚Çπ${formatNumber(it.price)} x ${it.qty} = ‚Çπ${formatNumber(it.price*it.qty)}`));
      const total=cart.reduce((s,it)=>s+it.price*it.qty,0);
      lines.push("",`Subtotal: ‚Çπ${formatNumber(total)}`,"","Please confirm payment & delivery details.");
      return lines.join("\n");
    }

    // ---------- Init ----------
    (function init(){ renderCart(); setTimeout(()=>syncCartButtons(),400); })();
    document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeCartDrawer(); });
  </script>

  </body>
  </html>
