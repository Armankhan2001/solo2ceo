<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Customer Reviews</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-indigo-50 to-white min-h-screen flex flex-col items-center p-6">

  <!-- Header -->
  <header class="text-center mb-8">
    <h1 class="text-4xl font-extrabold text-indigo-700 flex items-center justify-center gap-2">
      ⭐ Customer Reviews
    </h1>
    <p class="text-gray-500 text-sm mt-1">Live from your Google Sheet</p>
  </header>

  <!-- Search & Filter -->
  <div class="w-full max-w-4xl flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
    <input 
      type="text" 
      id="searchInput" 
      placeholder="🔍 Search by name, email, or location..." 
      class="w-full sm:w-2/3 px-4 py-3 rounded-xl border border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
    />
    <select id="filterSelect" class="w-full sm:w-1/3 px-4 py-3 rounded-xl border border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
      <option value="all">🌍 All Locations</option>
    </select>
  </div>

  <!-- Cards Container -->
  <div id="cardsContainer" class="w-full max-w-6xl grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Cards will be inserted here -->
  </div>

  <!-- Status Message -->
  <p id="statusMessage" class="text-gray-500 mt-8 text-center">Loading reviews...</p>

  <script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRTzdvmfVRC6ZgkxgLpjkILouwicSPGn3LfGuV2GG2LQ9wwq_XkLj-Oh7kpGYGCdyqTD6KJncJeB7C9/pub?output=csv";
    const cardsContainer = document.getElementById("cardsContainer");
    const statusMsg = document.getElementById("statusMessage");
    const searchInput = document.getElementById("searchInput");
    const filterSelect = document.getElementById("filterSelect");

    let reviews = [];

    async function fetchCSV() {
      try {
        const res = await fetch(SHEET_URL);
        const text = await res.text();
        reviews = parseCSV(text);
        populateFilter(reviews);
        renderCards(sortByLatest(reviews));
        statusMsg.textContent = "";
      } catch (err) {
        console.error("Error fetching CSV:", err);
        statusMsg.textContent = "⚠️ Failed to load data.";
      }
    }

    function parseCSV(csvText) {
      const lines = csvText.trim().split("\n");
      const header = lines.shift().split(",");
      return lines.map(line => {
        const parts = line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/);
        const obj = {};
        header.forEach((h, i) => {
          obj[h.trim()] = (parts[i] || "").trim().replace(/^"|"$/g, "");
        });
        return obj;
      });
    }

    function sortByLatest(data) {
      return data.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));
    }

    function populateFilter(data) {
      const locations = [...new Set(data.map(r => r.Location).filter(Boolean))];
      filterSelect.innerHTML = `<option value="all">🌍 All Locations</option>` +
        locations.map(loc => `<option value="${loc}">${loc}</option>`).join("");
    }

    function renderCards(data) {
      cardsContainer.innerHTML = "";
      if (!data.length) {
        cardsContainer.innerHTML = `<p class='col-span-full text-center text-gray-500 text-lg'>No reviews found 😕</p>`;
        return;
      }

      data.forEach(row => {
        const card = document.createElement("div");
        card.className = "bg-white rounded-2xl shadow-md hover:shadow-xl transition transform hover:-translate-y-1 p-6 border border-gray-100";

        card.innerHTML = `
          <div class="flex justify-between items-center mb-3">
            <h2 class="text-xl font-bold text-indigo-700 flex items-center gap-2">
              👤 ${row.Name || "Anonymous"}
            </h2>
            <span class="text-sm text-gray-400 flex items-center gap-1">🕒 ${row.Timestamp || ""}</span>
          </div>
          <p class="text-gray-600 text-sm flex items-center gap-2 mb-1">📧 <span>${row.Email || "—"}</span></p>
          <p class="text-gray-600 text-sm flex items-center gap-2 mb-1">📞 <span>${row.Phone || "—"}</span></p>
          <p class="text-gray-600 text-sm flex items-center gap-2 mb-1">💼 <span>${row.Occupation || "—"}</span></p>
          <p class="text-gray-600 text-sm flex items-center gap-2 mb-1">📍 <span>${row.Location || "—"}</span></p>
          <p class="mt-3 text-gray-800 text-base leading-relaxed bg-indigo-50 rounded-xl p-3 italic">💬 ${row.Message || "No message provided."}</p>
        `;

        cardsContainer.appendChild(card);
      });
    }

    function applyFilters() {
      const searchValue = searchInput.value.toLowerCase();
      const selectedLoc = filterSelect.value;
      let filtered = reviews.filter(row =>
        Object.values(row).some(val =>
          String(val).toLowerCase().includes(searchValue)
        )
      );
      if (selectedLoc !== "all") {
        filtered = filtered.filter(r => r.Location === selectedLoc);
      }
      renderCards(sortByLatest(filtered));
    }

    searchInput.addEventListener("input", applyFilters);
    filterSelect.addEventListener("change", applyFilters);

    fetchCSV();
  </script>
</body>
</html>

